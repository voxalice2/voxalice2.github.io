<!DOCTYPE html>
<html>
  <head>
    <title>the post generation station</title>
    <link href="/dark.css" rel="stylesheet" type="text/css" media="all">
  </head>
  
  <body>
    <h1>Personal Scratch forums QuickReply</h1>
    
    <div id="dataView">This webpage requires JavaScript.</div>
    
    <p style="display: none;" id="textDisplay"><textarea style='width: 50em; height: 10em;' id="copier" onclick='this.select()' readonly></textarea></p>
    <p style="display: none;" id="textEditable">Replace "__EDITABLE__" with: <input type="text" id="editBox" placeholder="Replacement" onchange="replaceEditable(this.value)"></p>
    
    <p style="display: none;" id="rejectedLoading">Fetching rejected suggestions...</p>
    <p style="display: none;" id="rejectedChooser">
      <a href="https://scratch.mit.edu/discuss/topic/343602/" target="blank">Open The Official List of Rejected Suggestions in a new tab</a>, find the relevant suggestion, then type its number here.
      <br><br><input type="text" id="rejectedNumber" placeholder="X.Y"> <button onclick='quoteRejected(document.querySelector("#rejectedNumber").value.toString())'>Quote</button>
      <br><br><a onclick='displayView("rejectedOriginal")'>Or, see the original Rejected Suggestion reply.</a>
    </p>
    
    <small>This webpage contains some of my most common responses to <a href="https://scratch.mit.edu/discuss/">Scratch forum topics</a>.
    <br>To view this webpage's source code, <a href='https://github.com/voxalice2/voxalice2.github.io/blob/main/quickreply.html'>click here!</a>
    <br><br><details><summary>Updates</summary><hr>
    Update 1 (2024-12-20) - Original version<hr>
    Update 2 (2024-12-21) - Fixed textboxes<hr>
    Update 3 (2024-12-22) - Added invisible items, <a onclick='displayView("test")'>test items</a>, and a JavaScript-disabled warning<hr>
    Update 4 (2024-12-23) - Added editable items<hr>
    Update 5 (2025-01-01) - Added function items, including a built-in quoter for The Official List of Rejected Suggestions
    </details></small>
    
    <script>
      // View data starts here
    
      var viewData = {
        
        // Root
        
        0: {"name": "Choose a forum:",
            "text": false,
            "hidden": false,
            "data": ["test", 6, 1, 2, 19, 20]},
            
        6: {"name": "General (any forum)",
            "text": false,
            "hidden": false,
            "data": [7, 8, 23]},
            
        1: {"name": "Bugs and Glitches",
            "text": false,
            "hidden": false,
            "data": [3, 4, 9, 12, 11, 24]},
            
        2: {"name": "Suggestions",
            "text": false,
            "hidden": false,
            "data": [5, 10]},
            
        19: {"name": "Things I'm Making and Creating",
            "text": false,
            "hidden": false,
            "data": [21]},
            
        20: {"name": "Things I'm Reading and Playing",
            "text": false,
            "hidden": false,
            "data": [22]},
            
        // Bugs and Glitches
            
        3: {"name": "Search Engine Down",
            "text": true,
            "hidden": false,
            "editable": false,
            "data": "[url=https://scratch.mit.edu/discuss/topic/790866/]Scratch's search engine is currently broken[/url], and all we can do is wait for it to be fixed.\n" +
                    "Unfortunately, no one seems to know what's causing issues or when they will be fixed.\n" +
                    "This affects everyone on Scratch, so the Scratch Team is aware of the situation.\n\n" +
                    'For now, you can type "site:scratch.mit.edu [i](query)[/i]" into an external search engine to work around this bug.'},
                    
        4: {"name": "Search Engine Down (+ User Searching)",
            "text": true,
            "hidden": false,
            "editable": false,
            "data": "[url=https://scratch.mit.edu/discuss/topic/790866/]Scratch's search engine is currently broken[/url], and all we can do is wait for it to be fixed.\n" +
                    "Unfortunately, no one seems to know what's causing issues or when they will be fixed.\n" +
                    "This affects everyone on Scratch, so the Scratch Team is aware of the situation.\n\n" +
                    'For now, you can type "site:scratch.mit.edu [i](query)[/i]" into an external search engine to work around this bug.\n\n' +
                    "If you want to [url=https://en.scratch-wiki.info/wiki/How_do_I_search_for_a_user%3F]search for a user[/url], use a link like this:\n" +
                    "[quote]https://scratch.mit.edu/users/USERNAME/[/quote]"},
                    
        9: {"name": "Cloud Variables Resetting",
            "text": true,
            "hidden": false,
            "editable": false,
            "data": "If you own the project with the broken cloud variables, try renaming those variables.\n\n" +
                    "If you don't own the project with the broken cloud variables, please ask the owner of that project to rename their cloud variables."},
                    
        12: {"name": "Cloud Variables Down",
            "text": true,
            "hidden": false,
            "editable": false,
            "data": "Cloud variables are currently broken, and all we can do is wait for them to be fixed.\n" +
                    "Unfortunately, no one seems to know what's causing issues or when they will be fixed.\n" +
                    "This affects everyone on Scratch, so the Scratch Team is aware of the situation."},
                    
        11: {"name": "Browser Information Instructions",
            "text": true,
            "hidden": false,
            "editable": false,
            "data": "When replying, could you click the globe icon (to the right of the emoji) to show what device and browser you're using?"},
            
        24: {"name": "Can't Become a Scratcher (No Next Button)",
            "text": true,
            "hidden": false,
            "editable": false,
            "data": 'From [url=https://scratch.mit.edu/discuss/topic/795734/]How to fix the "Next" button not appearing on the Become a Scratcher page[/url]:\n' +
                    "[quote=NotK3ndricAltAgain][b]STEP 1:[/b] Click on the link to become a Scratcher.\n\n" +
                    "[b]STEP 2:[/b] Tap/click the Next button to read the community guidelines.\n\n" +
                    "[b]STEP 3:[/b] Try clicking near the bottom right of the screen, you should be on the next page.\n\n" +
                    "Hope this helped! [img=https://u.cubeupload.com/fmji/1f601.png][/quote]"},
                    
        // Suggestions
        
        5: {"name": "Duplicate Suggestion",
            "text": true,
            "hidden": false,
            "editable": true,
            "data": "This is a duplicate of [url=__EDITABLE__]an earlier suggestion[/url].\n" +
                    "Please use the linked topic to keep the discussion all in one place :)\n\n" +
                    "For future reference, you can use the [url=https://scratch.mit.edu/discuss/topic/657522/]Suggestions Directory[/url] or [url=https://ocular.jeffalo.net/]Ocular[/url] to check for duplicates."},
                    
        10: {"name": "Rejected Suggestion",
            "text": false,
            "hidden": false,
            "editable": false,
            "function": "rejected()"},
            
        "rejectedOriginal": {"name": "Rejected Suggestion (Original)",
            "text": true,
            "hidden": false,
            "editable": false,
            "data": "Unfortunately, this suggestion is rejected.\n\n" +
                    "From [url=https://scratch.mit.edu/discuss/topic/343602/]The Official List of Rejected Suggestions[/url]:\n" +
                    "[quote=Za-Chary]View_source_then_find_the_rejected_suggestion_then_paste_it_here[/quote]"},
                    
        // General
        
        7: {"name": "Duplicate Topic",
            "text": true,
            "hidden": false,
            "editable": true,
            "data": "This is a duplicate of [url=__EDITABLE__]an earlier topic[/url].\n" +
                    "Please use the linked topic to keep the discussion all in one place :)\n\n" +
                    "For future reference, you can use the third-party search engine [url=https://ocular.jeffalo.net/]Ocular[/url] to check for duplicates."},
                    
        8: {"name": "Topic Closing Instructions",
            "text": true,
            "hidden": false,
            "editable": false,
            "data": "If you don't see a Close Topic button anywhere, you can just report the original post and ask the Scratch Team to close it in the textbox.\n\n" +
                    "I'll do that for you right now. :)"},
                    
        23: {"name": "Welcome to the Forums",
            "text": true,
            "hidden": false,
            "editable": false,
            "data": "Welcome to the forums! Check out the Sticky topics in [url=https://scratch.mit.edu/discuss/6/]the New Scratchers forum[/url] for guidance."},
                    
        // Things I'm [...]
        
        21: {"name": "Duplicate Topic (Things I'm Making and Creating)",
            "text": true,
            "hidden": false,
            "editable": true,
            "data": "This is a duplicate of [url=__EDITABLE__]an earlier topic[/url].\n" +
                    "Please use the linked topic to keep the discussion all in one place :)\n\n" +
                    "For future reference, you can use the [url=https://scratch.mit.edu/discuss/topic/776027/]Things I'm Making and Creating Directory[/url] or [url=https://ocular.jeffalo.net/]Ocular[/url] to check for duplicates."},
                    
        22: {"name": "Duplicate Topic (Things I'm Reading and Playing)",
            "text": true,
            "hidden": false,
            "editable": true,
            "data": "This is a duplicate of [url=__EDITABLE__]an earlier topic[/url].\n" +
                    "Please use the linked topic to keep the discussion all in one place :)\n\n" +
                    "For future reference, you can use the [url=https://scratch.mit.edu/discuss/topic/735680/]Things I'm Reading and Playing Topic Directory[/url] or [url=https://ocular.jeffalo.net/]Ocular[/url] to check for duplicates."},
                    
        // Testing
        
        "test": {"name": "> TESTING <",
            "text": false,
            "hidden": true,
            "data": ["this page doesn't exist", "test", 14, 15, Math.imul(3, 5) + 1, 17, 18, 0, "settings"]},
        
        14: {"name": "Hidden item 1",
            "text": true,
            "hidden": true,
            "data": "HELLO WORLD"},
                    
        15: {"name": "Hidden item 2!",
            "text": false,
            "hidden": true,
            "data": [1, 2, 3]},
            
        16: {"name": "Invalid content 1",
            "text": false,
            "hidden": false,
            "data": "Wow"},
            
        17: {"name": "Invalid content 2",
            "text": true,
            "hidden": false,
            "data": [1, 2, 3]},
            
        18: {"name": "Invalid content 3!",
            "text": false,
            "hidden": false,
            "data": true},
            
      }
      
      // View data ends here
      
      var dataView = document.querySelector("#dataView");
      var textDisplay = document.querySelector("#textDisplay");
      var textEditable = document.querySelector("#textEditable");
      var copier = document.querySelector("#copier");
      
      var rejectedLoading = document.querySelector("#rejectedLoading");
      var rejectedChooser = document.querySelector("#rejectedChooser");
      var rejectedData = "";
      
      var viewHistory = [];
      var viewing;
      
      function appendLink(id, name, back) {
        linkElement = document.createElement("button");
        linkElement.innerText = name ? name : viewData[id].name;
        
        if (back) {
          linkElement.onclick = function() { displayLastItem(); };
        } else {
          linkElement.onclick = function() { displayView(id); };
        }
        
        linkContainer = document.createElement("p");
        linkContainer.append(linkElement);
        if (!viewData[id].hidden) { dataView.append(linkContainer); }
      }
      
      function displayLastItem() {
        viewHistory.pop(); displayView(viewHistory.pop());
      }
      
      function displayView(id) {
        if (id == undefined) { id = 0; }
        viewing = id;
        data = viewData[id];
        
        console.log("Displaying data at ID " + id, data);
        
        // Display name of item
        
        dataView.innerHTML = "";
        nameElement = document.createElement("h2");
        nameElement.innerText = data.name;
        dataView.append(nameElement);
        
        // Append "Back" link and hide everything (except for the name)
        
        viewHistory.push(id);
        if (viewHistory.length > 1) { appendLink(0, "<= Back to previous page <=", true); }
        
        textEditable.style.display = "none";
        textDisplay.style.display = "none";
        rejectedLoading.style.display = "none";
        rejectedChooser.style.display = "none";
        document.querySelector("#editBox").value = "";
        
        // Start handling data
        
        if (data.text) {
          textDisplay.style.display = "block";
          copier.innerHTML = data.data.toString();
          
          if (data.editable) {
            textEditable.style.display = "block";
          }
        } else {
          if (data.function) {
            eval?.(`"use strict";${data.function}`);
          } else {
            if (typeof data.data == "object") {
              data.data.forEach((element) => {
                try { appendLink(element, null, false); }
                catch (exception) { console.error(exception); }
              });
            }
          }
        }
      }
      
      function replaceEditable(edit) {
        if (edit == "") { edit = "__EDITABLE__"; }
        copier.innerHTML = viewData[viewing].data.toString().replace("__EDITABLE__", edit);
      }
      
      displayView(0, false);
      
      // Rejected Suggestions code starts here
      
      async function getRejected() {
        if (rejectedData == "") {
          try {
            const response = await fetch("https://scratch.mit.edu/discuss/post/3466932/source/");
            if (!response.ok) {
              throw new Error(`Response status: ${response.status}`);
            }
  
            rejectedData = await response.text();
            return true;
          } catch (e) {
            console.error(e);
            alert("Something went wrong fetching rejected suggestions. Check this browser's console for more information.");
            return false;
          }
        } else {return true}
      }
      
      function rejected() {
        rejectedLoading.style.display = "none";
        rejectedChooser.style.display = "block";
        document.querySelector("#rejectedNumber").value = "";
      }
      
      function quoteRejected(rejectedNumber) {
        var requestConfirmed;
        if (rejectedData == "") {requestConfirmed = confirm("This action will make a request to scratch.mit.edu.")}
        else {requestConfirmed = true}
        
        if (requestConfirmed) {
          rejectedLoading.style.display = "block";
          rejectedChooser.style.display = "none";
          
          getRejected().then((good) => {
            if (good) {
              rejectedLoading.style.display = "none";
              var rejectedQuote = "";
              
              quoteDelimiter = "[b]" + rejectedNumber + " ";
              try { rejectedQuote = (quoteDelimiter + rejectedData.split(quoteDelimiter)[1].split("[b]")[0]).trim(); }
              catch (e) { console.error(e.message); rejectedChooser.style.display = "block"; alert("That doesn't seem to be a valid suggestion number. Check for typos."); }
              
              if (rejectedQuote != "") {
                textEditable.style.display = "none";
                rejectedChooser.style.display = "none";
                
                textDisplay.style.display = "block";
                copier.innerHTML = "Unfortunately, this suggestion is rejected.\n\n" +
                                   "From [url=https://scratch.mit.edu/discuss/topic/343602/]The Official List of Rejected Suggestions[/url]:\n" +
                                   "[quote=Za-Chary]" + rejectedQuote + "[/quote]";
              }
            } else { rejected(); }
          })
        }
      }
    </script>
    
    <script src="/stable.js"></script>
  </body>
</html>
